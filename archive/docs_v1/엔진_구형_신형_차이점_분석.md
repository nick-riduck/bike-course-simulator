# 🔄 물리 엔진 v1.0(Legacy) vs v2.0(Current) 차이점 비교 분석

본 문서는 프로젝트 초기에 작성된 문서(`cycling_simulation.md`, `source_python.md`)와 현재 실제로 구현된 코드(`src/physics_engine.py`) 사이의 논리적, 구조적 차이를 명확히 하기 위해 작성되었습니다.

---

## 1. 물리 엔진 코어 (Physics Engine Core)

가장 큰 차이점은 속도를 구하는 **수치 해석 방법론**의 변화입니다.

| 항목 | v1.0 (기존 문서 - 구형) | v2.0 (현재 코드 - 신형) |
| :--- | :--- | :--- |
| **핵심 알고리즘** | **고정점 반복법** (Fixed-point Iteration) | **이분 탐색법** (Bisection Method) |
| **속도 계산 방식** | 가속도를 구해 이전 속도에 합산 | 에너지 평형을 만족하는 속도를 탐색 |
| **수치적 안정성** | 저속/급경사에서 값이 튀거나 멈춤 | 어떤 조건에서도 무조건 정확한 해에 수렴 |
| **0.0 km/h 버그** | Relaxation 보정 오차로 자주 발생 | 논리적으로 완벽히 해결됨 |

---

## 2. 생리학적 모델링 (Physiological Modeling)

라이더의 파워 출력 한계를 설정하는 방식이 단순 모델에서 하이브리드 모델로 진화했습니다.

| 항목 | v1.0 (기존 문서 - 구형) | v2.0 (현재 코드 - 신형) |
| :--- | :--- | :--- |
| **기준 파워** | **CP** (Critical Power) 단일 의존 | **PDC** (Power Duration Curve) + CP 혼합 |
| **피로도 전략** | 고정 지수(0.12)로 파워 감쇠 | **PDC Blending** (시간별 가중치 조절) |
| **단거리 (북악)** | CP 기반 페이싱으로 과소평가됨 | PDC 100% 활용으로 폭발적 기록 가능 |
| **장거리 (설악)** | 급격한 파워 저하 발생 | 현실적 지수(0.07) 적용으로 지구력 반영 |

---

## 3. 보정 및 안전장치 (Safeguards)

v1.0은 불안정한 엔진을 잡기 위해 인위적인 코드를 많이 넣었으나, v2.0은 엔진 자체가 튼튼하여 이를 제거했습니다.

| 항목 | v1.0 (기존 문서 - 구형) | v2.0 (현재 코드 - 신형) |
| :--- | :--- | :--- |
| **진동 방지** | Relaxation (반반 섞기) 필수 적용 | **제거됨** (순수 물리 수치 반영) |
| **토크 제한** | 1.5G(약 1200N)로 인위적 제한 | **제거됨** (물리적 한계까지 사용) |
| **최저 속도** | 1.8 km/h 이하 시 계산 왜곡 | 0.03 km/h 같은 극저속도 정밀 계산 |
| **코너링 감속** | 단순 수치 적용 혹은 미구현 | 물리 기반($V=\sqrt{\mu g R}$) 감속 구현 |

---

## 4. 시뮬레이션 기록 차이 (Rider A 83kg 기준)

| 코스 | v1.0 예측 (구형) | v2.0 실측 (신형) | 분석 |
| :--- | :--- | :--- | :--- |
| **북악 (2.5km)** | 9분 50초 | **7분 34초 ~ 8분 35초** | 파워 제한 해제로 실측값과 일치 |
| **설악 (208km)** | 8시간 50분 | **8시간 12분** | 계산 누수가 사라져 평속 상승 |

---

## 💡 결론
현재 `source_python.md` 등에 남아있는 코드는 **"폐기된 설계도"**입니다. 
신형 엔진(v2.0)은 **이분 탐색**이라는 강력한 수학적 도구를 통해 보정 장치들을 다 떼어내고도 훨씬 정확한 결과를 산출합니다.

코드를 이해하거나 수정할 때는 반드시 **`src/physics_engine.py`**와 **`docs/SIMULATOR_WHITEPAPER.md`**를 참고해야 합니다.